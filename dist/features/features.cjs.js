"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const f=require("../shared/convert.cjs.js"),y=require("jsonpath-js"),S=(a,n)=>`${n}[${a.map(e=>`"${e.name}"`).join(",")}]`,g={undefinedStruct:"undefined_struct",cyclicStruct:"cyclic_struct"};function b(a,n,e){if(a.frames.length===0)return a;const t=a.frames[a.frames.length-1],s=a.frames.slice(0,-1);if(t.ancestry.includes(t.schemaName))return{frames:s,items:a.items,errs:[...a.errs,{code:e.cyclicStruct,path:t.basePath}]};const r=n.get(t.schemaName);if(!r)return{frames:s,items:a.items,errs:[...a.errs,{code:e.undefinedStruct,path:t.basePath}]};const m=function(c,u){const l=c.ancestry.concat(c.schemaName),o=c.basePath;return[...u.structs.map(i=>({schemaName:i.attr.struct,basePath:`${o}.${i.name}`,ancestry:l})),...u.structArrays.map(i=>({schemaName:i.attr.struct,basePath:`${o}.${i.name}[*]`,ancestry:l}))].reverse()}(t,r);if(r.scalas.length>0||r.scalaArrays.length>0){const c=function(u,{path:l,structName:o}){return{arraySchema:f.toObjectPluginParams(u.scalaArrays),objectSchema:f.toObjectPluginParams(u.scalas),structName:o,scalaArrays:(i=u.scalaArrays,h=l,i.map(p=>({path:`${h}.${p.name}[*]`,param:p}))),scalas:u.scalas.length>0?S(u.scalas,l):void 0};var i,h}(r,{path:t.basePath,structName:t.schemaName});return s.push(...m),{frames:s,items:[...a.items,c],errs:a.errs}}return s.push(...m),{frames:s,items:a.items,errs:a.errs}}function P(a,n,e,t){const s={items:[],errs:[],frames:[{schemaName:a,basePath:n,ancestry:[]}]},r=Math.max(1,3*e.size+5),m=Array.from({length:r}).reduce(c=>c.frames.length===0?c:b(c,e,t),s);return{items:m.items,errors:m.errs}}const d=(a,n,e)=>a.reduce((t,{segments:s,value:r})=>{if(typeof r=="object")return t;const m=s[s.length-1];if(typeof m=="number")return t;const c=n.objectSchema[m];if(!c)return t;const u={value:r,structName:e,param:{name:m,attr:c}};return[...t,u]},[]);exports.extractArrayValuesFromJson=(a,n)=>n.scalaArrays.map(e=>((t,s)=>{const r=new y.JSONPathJS(s.path).find(t);if(!Array.isArray(r))return null;const m=s.param.attr;return f.isStringArrayParam(m)?{values:r.filter(c=>typeof c=="string"),valueKind:"string",param:{name:s.param.name,attr:m}}:f.isNumberArrayParam(m)?{values:r.filter(c=>typeof c=="number"),valueKind:"number",param:{name:s.param.name,attr:m}}:null})(a,e)).filter(e=>e!==null),exports.extractScalaValuesFromJson=(a,n)=>{if(!n.scalas)return[];const e=new y.JSONPathJS(n.scalas).pathSegments(a);return d(e,n,n.structName)},exports.getPathFromStructParam=(a,n,e,t=g)=>{const s=a.map(r=>P(r.attr.struct,`${n}.${r.name}`,e,t));return{items:s.flatMap(r=>r.items),errors:s.flatMap(r=>r.errors)}},exports.getPathFromStructSchema=(a,n,e,t=g)=>P(a,n,e,t);
